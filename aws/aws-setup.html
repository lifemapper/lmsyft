<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Authentication &mdash; Specify Network  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="AWS Workflow" href="aws_workflow.html" />
    <link rel="prev" title="Terms of Service" href="../about/tos.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Specify Network
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/s2n_overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/install_run_notes.html">Install/Run Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/tos.html">Terms of Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AWS:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-an-iam-role-for-the-ec2-redshift-s3-interaction">Create an IAM role for the EC2/Redshift/S3 interaction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ec2-instance-creation">EC2 instance creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#for-programmatic-access-to-s3">For programmatic access to S3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redshift">Redshift</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-a-new-workgroup-and-namespace">Create a new workgroup (and namespace)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connect-to-new-namespace-in-query-editor">Connect to new namespace in Query Editor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-for-data-acquisition-and-analyses">Configure for data acquisition and analyses</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-a-security-group-for-the-region">Create a Security Group for the region</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-aws-elastic-compute-cloud-ec2-instance">Create AWS Elastic Compute Cloud (EC2) instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enable-ssh-access-to-ec2">Enable SSH access to EC2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#aws-access-keypair">AWS access: keypair</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-up-local-client">Set up local/client</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connect-and-set-ec2-ssh-service-timeout">Connect and set EC2 SSH service timeout</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-software-on-ec2">Install software on EC2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#base-software">Base software</a></li>
<li class="toctree-l2"><a class="reference internal" href="#docker">Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#add-the-github-repo-to-ec2-instance">Add the Github repo to EC2 instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enable-s3-access-from-local-machine-and-ec2">Enable S3 access from local machine and EC2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#error-ssl">Error: SSL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#workflow-for-specify-network-analyst-pre-computations">Workflow for Specify Network Analyst pre-computations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aws_workflow.html">AWS Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws_experiment.html">AWS strategy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/debugging.html">Debugging Flask and Docker instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/example_sp6_export.html">Example Specify 6 Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/ssl_certificates.html">Specify Network SSL certificates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/taxonomy_tools.html">GBIF Backbone Taxonomy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/testing.html">Testing Specify Network elements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Specify Network</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Authentication</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/aws/aws-setup.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="authentication">
<h1>Authentication<a class="headerlink" href="#authentication" title="Link to this heading"></a></h1>
<section id="create-an-iam-role-for-the-ec2-redshift-s3-interaction">
<h2>Create an IAM role for the EC2/Redshift/S3 interaction<a class="headerlink" href="#create-an-iam-role-for-the-ec2-redshift-s3-interaction" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Create a Role (Redshift-S3) for service Redshift to read/write to S3</p>
<ul>
<li><p>Add a policy allowing read and write access to the specnet S3 bucket</p></li>
<li><p>Step 1: Trusted entity type = AWS service, Use Case = Redshift - Customizable.</p>
<ul>
<li><p>TODO: change to Redshift - Scheduler when we automate the workflow</p></li>
</ul>
</li>
<li><p>Step 2: Add permissions</p>
<ul>
<li><p>AmazonRedshiftAllCommandsFullAccess (AWS managed)</p></li>
<li><p>AmazonS3FullAccess (AWS managed)</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<section id="ec2-instance-creation">
<h3>EC2 instance creation<a class="headerlink" href="#ec2-instance-creation" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Instance type t3.small</p>
<ul>
<li><p>Build fails with t2.micro or t3.micro with 1gb RAM</p></li>
<li><p>t3.small is 2gb RAM</p></li>
</ul>
</li>
<li><p>Ubuntu Server 22.04 LTS, SSD Volume Type (free tier eligible), x86 architecture</p></li>
<li><p>Security Group: launch-wizard-1</p></li>
<li><p>30 Gb General Purpose SSD (gp2)</p></li>
<li><p>For dev, Spot instance (in Advanced options)</p></li>
<li><p>Modify IAM role - for role created above (i.e. specnet_ec2_role)</p></li>
</ul>
</section>
<section id="for-programmatic-access-to-s3">
<h3>For programmatic access to S3<a class="headerlink" href="#for-programmatic-access-to-s3" title="Link to this heading"></a></h3>
<p>Configure AWS credentials either through</p>
<ul class="simple">
<li><p>environment variables</p></li>
<li><p>AWS CLI configuration (for command line tools), or</p></li>
<li><p>using an IAM role attached to your instance if running on AWS infrastructure.</p></li>
</ul>
<p>The AWS cli depends on boto3, so both must be up to date.  In my testing, awscli
1.27.118 (with requirement botocore==1.29.118) and boto3 1.28.1, failed on
S3 Select access.</p>
<p>I upgraded awscli (sudo apt install awscli), then upgraded boto3
(pip install –upgrade boto3) , which installed 1.34.60.  Success</p>
</section>
<section id="redshift">
<h3>Redshift<a class="headerlink" href="#redshift" title="Link to this heading"></a></h3>
</section>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Redshift allows you to work with very large datasets in parallel very quickly.</p></li>
<li><p>Redshift acts as a database application, and can connect to databases created in
Redshift, Glue Data Catalogs, and mount tabular data in S3</p></li>
<li><p>The default new database is “dev”, and it contains the “public” schema. The
schema contains Tables, Views, Functions, and Stored Procedures.</p></li>
<li><p>To mount S3 data, you must create an external schema in the database, and define
the new data, including all of its fields and its S3 location.  These functions are
included in the script rs_subset_gbif.sql</p></li>
<li><p>After mounting a table, you can filter the data into a new table in your public
schema, then drop the table in the external schema (the original S3 data).</p></li>
<li><p>We currently filter out data with missing latitude or longitude, taxonomic ranks above
species level, and records with a basis of record that is not observation, occurrence,
or preserved specimen.  This brings the full dataset from about 2.6 billion down to
2.3 billion.</p></li>
</ul>
</section>
<section id="create-a-new-workgroup-and-namespace">
<h2>Create a new workgroup (and namespace)<a class="headerlink" href="#create-a-new-workgroup-and-namespace" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>In the Redshift dashbord, choose the button <strong>Create workspace</strong> to create a new
workgroup and namespace.  The resulting form shows 3 steps.</p>
<ul>
<li><p>Step 1, define the Workgroup name, Capacity, and Network and Security.
Choose a name, i.e. <strong>specnet</strong>, and keep the defaults for the Capacity, VPC, and
Subnets</p></li>
<li><p>Step 2, set up a namespace.  Create a new one, i.e. <strong>specnet</strong> (we are using
the same name for the worksgroup and namespace).  Retain the first database name
(dev) and leave the Admin user credentials as the default (unchecked Customize
box).  Check the the default Associated IAM role or create a new role.
Leave Encryption and security settings unchanged.</p>
<ul>
<li><p>Make sure that the Associated IAM role has permission to access the bucket
you will write to (use Redshift-S3 created above)</p></li>
<li><p>Make new Redshift-S3 Role the default for Redshift operations in this
namespace</p></li>
</ul>
</li>
<li><p>Step 3, review and create workspace.  This will take some time.</p></li>
</ul>
</li>
</ul>
</section>
<section id="connect-to-new-namespace-in-query-editor">
<h2>Connect to new namespace in Query Editor<a class="headerlink" href="#connect-to-new-namespace-in-query-editor" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Choose <strong>Query editor v2</strong> in the Redshift dashboard left-side menu</p></li>
<li><p>Choose the new workgroup “Serverless: specnet” in the resource list</p>
<ul>
<li><p>From the resulting dialog, choose “Other ways to connect” and “Federated user”
then click the button “Create connection”</p></li>
<li><dl class="simple">
<dt>The connection will become active, and the new “dev” database will</dt><dd><p>appear, as well as any other data catalogs your user account has access to.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>In the top of the right pane, click the + sign to open a new tab for writing</dt><dd><p>and executing commands.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Paste in the contents of rs_create_sps_functions.sql to create functions and</dt><dd><p>stored procedures to be used in this workspace.</p>
</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
<section id="configure-for-data-acquisition-and-analyses">
<h2>Configure for data acquisition and analyses<a class="headerlink" href="#configure-for-data-acquisition-and-analyses" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Create a bucket to hold relevant data</p></li>
<li><p>Create output folders for tables to be written from rs_summarize_data.sql</p></li>
<li><p>Make sure that Redshift namespace/workgroup has permission to write to the S3 bucket</p></li>
</ul>
<section id="create-a-security-group-for-the-region">
<h3>Create a Security Group for the region<a class="headerlink" href="#create-a-security-group-for-the-region" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Create a security group for the instance (and all other instances in region)
* Must be tied to the region of instance
* aimee.stewart_SG_useast1
* inbound: SSH from campus, HTTP/HTTPS from all</p></li>
</ul>
</section>
<section id="create-aws-elastic-compute-cloud-ec2-instance">
<h3>Create AWS Elastic Compute Cloud (EC2) instance<a class="headerlink" href="#create-aws-elastic-compute-cloud-ec2-instance" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Create from AMI (or not for new config)</p></li>
<li><p>Use the security group created for this region</p></li>
<li><p>Default user for ubuntu instance is <cite>ubuntu</cite></p></li>
<li><p>(opt) Request an Elastic IP and assign DNS to it
* Register FQDN (GoDaddy) to IP for public access</p></li>
</ul>
</section>
<section id="enable-ssh-access-to-ec2">
<h3>Enable SSH access to EC2<a class="headerlink" href="#enable-ssh-access-to-ec2" title="Link to this heading"></a></h3>
</section>
</section>
<section id="aws-access-keypair">
<h2>AWS access: keypair<a class="headerlink" href="#aws-access-keypair" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Create a keypair for SSH access (tied to region) on EC2 launch</p></li>
<li><p>One chance only: Download the private key (.pem file for Linux and OSX) to local machine</p></li>
<li><p>Set file permissions to 400</p></li>
</ul>
</section>
<section id="set-up-local-client">
<h2>Set up local/client<a class="headerlink" href="#set-up-local-client" title="Link to this heading"></a></h2>
<ul>
<li><p>Copy SSH private key to each machine used for AWS access</p></li>
<li><p>Extend the SSH timeout in local ssh client config file ~/.ssh/config:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Host</span> <span class="o">*</span>
    <span class="n">ServerAliveInterval</span> <span class="mi">20</span>
</pre></div>
</div>
</li>
<li><p>then login with private key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">-</span><span class="n">i</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/&lt;</span><span class="n">your_aws_key</span><span class="o">&gt;.</span><span class="n">pem</span> <span class="n">ubuntu</span><span class="nd">@xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xx</span><span class="o">.</span><span class="n">xx</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="connect-and-set-ec2-ssh-service-timeout">
<h2>Connect and set EC2 SSH service timeout<a class="headerlink" href="#connect-and-set-ec2-ssh-service-timeout" title="Link to this heading"></a></h2>
<ul>
<li><p>Extend the SSH timeout (in AMI or instance?) in new config file (&lt;proj_name&gt;.conf)
under ssh config dir (/etc/ssh/sshd_config.d):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ClientAliveInterval</span> <span class="mi">1200</span>
<span class="n">ClientAliveCountMax</span> <span class="mi">3</span>
</pre></div>
</div>
</li>
<li><p>Reload SSH with new configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo systemctl reload sshd
</pre></div>
</div>
</li>
</ul>
<section id="install-software-on-ec2">
<h3>Install software on EC2<a class="headerlink" href="#install-software-on-ec2" title="Link to this heading"></a></h3>
</section>
</section>
<section id="base-software">
<h2>Base software<a class="headerlink" href="#base-software" title="Link to this heading"></a></h2>
<ul>
<li><p>update apt</p></li>
<li><p>install AWS client, awscli</p></li>
<li><p>install apache for getting/managing certificates</p></li>
<li><p>install certbot for Let’s Encrypt certificates:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt update
$ sudo apt install awscli
$ sudo apt install apache2
$ sudo apt install certbot
$ sudo apt install plocate
</pre></div>
</div>
</li>
</ul>
</section>
<section id="docker">
<h2>Docker<a class="headerlink" href="#docker" title="Link to this heading"></a></h2>
<p>Follow instructions at <a class="reference external" href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/</a></p>
<ul>
<li><p>Set up the repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get update
$ sudo apt-get install ca-certificates curl gnupg
</pre></div>
</div>
</li>
<li><p>Add Docker GPG key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo install -m 0755 -d /etc/apt/keyrings
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
$ sudo chmod a+r /etc/apt/keyrings/docker.gpg
</pre></div>
</div>
</li>
<li><p>Set up the docker repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo \
  &quot;deb [arch=&quot;$(dpkg --print-architecture)&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  &quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; stable&quot; | \
  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</pre></div>
</div>
</li>
<li><p>Update apt and install Docker Engine, containerd, and Docker Compose:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get update
$ sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</pre></div>
</div>
</li>
</ul>
<section id="add-the-github-repo-to-ec2-instance">
<h3>Add the Github repo to EC2 instance<a class="headerlink" href="#add-the-github-repo-to-ec2-instance" title="Link to this heading"></a></h3>
<ul>
<li><p>Generate a local ssh key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh-keygen -t ed25519 -C &quot;&lt;your_email@address&gt;&quot;
$ eval &quot;$(ssh-agent -s)&quot;
$ ssh-add ~/.ssh/id_ed25519
</pre></div>
</div>
</li>
<li><p>Add the ssh key to Github</p>
<ul>
<li><p>In the Github website, login, and navigate to your user profile</p></li>
<li><p>Select <strong>SSH and GPG keys</strong> from the left vertical menu</p></li>
<li><p>Choose <strong>New SSH key</strong></p></li>
<li><p>In a terminal window, copy the key to the clipboard:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat ~/.ssh/id_ed25519.pub
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>In the resulting text window, add your public key, and tie with your EC2 instance
with a memorable name</p></li>
<li><p>Clone the repository to the EC2 instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">specifysystems</span><span class="o">/</span><span class="n">sp_network</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="enable-s3-access-from-local-machine-and-ec2">
<h3>Enable S3 access from local machine and EC2<a class="headerlink" href="#enable-s3-access-from-local-machine-and-ec2" title="Link to this heading"></a></h3>
<ul>
<li><p>Configure AWS credentials and defaults</p>
<ul>
<li><p>Using aws_cli:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">written</span> <span class="n">to</span> <span class="o">~/.</span><span class="n">aws</span><span class="o">/</span><span class="n">config</span>
</pre></div>
</div>
<p>aws configure set default.region region;
aws configure set default.output json;</p>
<p>– Configure AWS; written to ~/.aws/credentials
aws configure set aws_access_key_id “”;
aws configure set aws_secret_access_key “”;</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<div><ul>
<li><p>or setting environment variables in ~/.bashrc:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># AWS credentials and defaults</span>
<span class="n">export</span> <span class="n">AWS_DEFAULT_REGION</span><span class="o">=</span><span class="n">region</span>
<span class="n">export</span> <span class="n">AWS_CA_BUNDLE</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">ca</span><span class="o">-</span><span class="n">certificates</span><span class="o">.</span><span class="n">crt</span>
<span class="n">export</span> <span class="n">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="n">xxx</span>
<span class="n">export</span> <span class="n">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="n">xxx</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<ul>
<li><p>Test access locally with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ aws s3 ls
$ aws ec2 describe-instances
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="error-ssl">
<h2>Error: SSL<a class="headerlink" href="#error-ssl" title="Link to this heading"></a></h2>
<p>First time:</p>
<p>Error message</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SSL</span> <span class="n">validation</span> <span class="n">failed</span> <span class="k">for</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ec2</span><span class="o">.</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mf">1.</span><span class="n">amazonaws</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
<span class="p">[</span><span class="n">SSL</span><span class="p">:</span> <span class="n">CERTIFICATE_VERIFY_FAILED</span><span class="p">]</span> <span class="n">certificate</span> <span class="n">verify</span> <span class="n">failed</span><span class="p">:</span> <span class="n">unable</span> <span class="n">to</span> <span class="n">get</span> <span class="n">local</span> <span class="n">issuer</span>
<span class="n">certificate</span> <span class="p">(</span><span class="n">_ssl</span><span class="o">.</span><span class="n">c</span><span class="p">:</span><span class="mi">1002</span><span class="p">)</span>
</pre></div>
</div>
<p>Test with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ aws s3 ls --no-verify-ssl
$ aws ec2 describe-instances --no-verify-ssl
</pre></div>
</div>
<p>Fix: Set up to work with Secret containing security key</p>
<p>Second time (in python code):
&gt;&gt;&gt; response = requests.get(url)
Traceback (most recent call last):</p>
<blockquote>
<div><dl class="simple">
<dt>File “/home/astewart/git/sp_network/venv/lib/python3.8/site-packages/urllib3/connectionpool.py”, line 703, in urlopen</dt><dd><p>httplib_response = self._make_request(</p>
</dd>
<dt>File “/home/astewart/git/sp_network/venv/lib/python3.8/site-packages/urllib3/connectionpool.py”, line 386, in _make_request</dt><dd><p>self._validate_conn(conn)</p>
</dd>
<dt>File “/home/astewart/git/sp_network/venv/lib/python3.8/site-packages/urllib3/connectionpool.py”, line 1042, in _validate_conn</dt><dd><p>conn.connect()</p>
</dd>
<dt>File “/home/astewart/git/sp_network/venv/lib/python3.8/site-packages/urllib3/connection.py”, line 419, in connect</dt><dd><p>self.sock = ssl_wrap_socket(</p>
</dd>
<dt>File “/home/astewart/git/sp_network/venv/lib/python3.8/site-packages/urllib3/util/<a href="#id1"><span class="problematic" id="id2">ssl_</span></a>.py”, line 449, in ssl_wrap_socket</dt><dd><p>ssl_sock = _ssl_wrap_socket_impl(</p>
</dd>
<dt>File “/home/astewart/git/sp_network/venv/lib/python3.8/site-packages/urllib3/util/<a href="#id3"><span class="problematic" id="id4">ssl_</span></a>.py”, line 493, in _ssl_wrap_socket_impl</dt><dd><p>return ssl_context.wrap_socket(sock, server_hostname=server_hostname)</p>
</dd>
<dt>File “/usr/lib/python3.8/ssl.py”, line 500, in wrap_socket</dt><dd><p>return self.sslsocket_class._create(</p>
</dd>
<dt>File “/usr/lib/python3.8/ssl.py”, line 1069, in _create</dt><dd><p>self.do_handshake()</p>
</dd>
<dt>File “/usr/lib/python3.8/ssl.py”, line 1338, in do_handshake</dt><dd><p>self._sslobj.do_handshake()</p>
</dd>
</dl>
</div></blockquote>
<p>ssl.SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)</p>
<p><a class="reference external" href="https://stackoverflow.com/questions/51925384/unable-to-get-local-issuer-certificate-when-using-requests">https://stackoverflow.com/questions/51925384/unable-to-get-local-issuer-certificate-when-using-requests</a></p>
<p>pip install certifi</p>
<p>import certifi
certifi.where()</p>
<section id="workflow-for-specify-network-analyst-pre-computations">
<h3>Workflow for Specify Network Analyst pre-computations<a class="headerlink" href="#workflow-for-specify-network-analyst-pre-computations" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Read <a class="reference external" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/plan-spot-fleet.html">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/plan-spot-fleet.html</a></p></li>
<li><p>work with: <a class="reference external" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/work-with-spot-fleets.html">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/work-with-spot-fleets.html</a></p></li>
<li><p>create request (console): <a class="reference external" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/work-with-spot-fleets.html#create-spot-fleet">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/work-with-spot-fleets.html#create-spot-fleet</a></p></li>
<li><p>Local</p>
<ul>
<li><p>Create an EC2 instance launch template</p></li>
<li><p>Create a Spot EC2 instance</p>
<ul>
<li><p>with create_fleet, prerequisites:
<a class="reference external" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/manage-ec2-fleet.html#ec2-fleet-prerequisites">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/manage-ec2-fleet.html#ec2-fleet-prerequisites</a></p></li>
<li><p>send “UserData” with scripts on instantiation</p></li>
</ul>
</li>
</ul>
</li>
<li><p>On new Spot EC2 instance</p>
<ul>
<li><p>UserData Script will run on startup</p>
<ul>
<li><p>Download from GBIF</p></li>
<li><p>Trim data and save as parquet format on Spot instance</p></li>
<li><p>Upload data to S3, delete on Spot</p></li>
</ul>
</li>
</ul>
</li>
<li><p>template of common software configuration</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../about/tos.html" class="btn btn-neutral float-left" title="Terms of Service" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="aws_workflow.html" class="btn btn-neutral float-right" title="AWS Workflow" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Specify Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>